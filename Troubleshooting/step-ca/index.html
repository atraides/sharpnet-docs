
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../OLD/webdav_server/" rel="prev"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.5+insiders-4.28.1" name="generator"/>
<title>Step CA - SharpNET</title>
<link href="../../assets/stylesheets/main.c97aee8c.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto Condensed";--md-code-font:"Roboto Mono"}</style>
<link href="/static/css/asciinema-player.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#step-ca">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="SharpNET" class="md-header__button md-logo" data-md-component="logo" href="../.." title="SharpNET">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            SharpNET
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Step CA
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="teal" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="teal" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/atraides/sharpnet-docs" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    atraides/sharpnet-docs
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="SharpNET" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="SharpNET">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    SharpNET
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/atraides/sharpnet-docs" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    atraides/sharpnet-docs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gpg_setup/">
<span class="md-ellipsis">
    
  
    How to setup GPG and SSH agent
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_3" tabindex="0">
<span class="md-ellipsis">
    
  
    Installations
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Installations" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Installations
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Installations/smilpdev8001/">
<span class="md-ellipsis">
    
  
    smilpdev8001.sharpnet.sdac
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Installations/smilprpi0010/">
<span class="md-ellipsis">
    
  
    smilprpi0010.sharpnet.sdac
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Installations/smilprpi0011/">
<span class="md-ellipsis">
    
  
    smilprpi0011.sharpnet.sdac
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4" tabindex="0">
<span class="md-ellipsis">
    
  
    OLD
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="OLD" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    OLD
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/acl/">
<span class="md-ellipsis">
    
  
    ACL setup
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/disable_systemd_resolver/">
<span class="md-ellipsis">
    
  
    How to disable systemd-resolver under Ubuntu
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/docker_controller/">
<span class="md-ellipsis">
    
  
    Docker Controller Hub
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/iscsi-target/">
<span class="md-ellipsis">
    
  
    iSCSI target on Ubuntu
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/remove_snapd/">
<span class="md-ellipsis">
    
  
    Remove snapd from Ubuntu
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/ubuntu-zfs/">
<span class="md-ellipsis">
    
  
    ZFS on Ubuntu
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/ubuntu_zfs_root/">
<span class="md-ellipsis">
    
  
    Install Ubuntu 22.04 on ZFS root filesystem
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../OLD/webdav_server/">
<span class="md-ellipsis">
    
  
    WebDAV server configuration
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_5" tabindex="0">
<span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Troubleshooting" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Step CA
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Step CA
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#yubikey-access">
<span class="md-ellipsis">
      
        YubiKey access
      
    </span>
</a>
<nav aria-label="YubiKey access" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-keys-on-the-yubikey">
<span class="md-ellipsis">
      
        Verify keys on the YubiKey
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-ca-configuration">
<span class="md-ellipsis">
      
        Step CA configuration
      
    </span>
</a>
<nav aria-label="Step CA configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-step-user-and-group">
<span class="md-ellipsis">
      
        Verify the step user and group
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-steppath-directory">
<span class="md-ellipsis">
      
        Verify the $STEPPATH directory
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rebuild-step-ca">
<span class="md-ellipsis">
      
        Rebuild Step CA
      
    </span>
</a>
<nav aria-label="Rebuild Step CA" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-yubikey-from-the-server">
<span class="md-ellipsis">
      
        Remove the YubiKey from the server
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-that-the-step-ca-service-is-stopped">
<span class="md-ellipsis">
      
        Verify that the step-ca service is stopped
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#set-the-steppath-envirnoment-variable">
<span class="md-ellipsis">
      
        Set the $STEPPATH envirnoment variable
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-old-configuration-folder">
<span class="md-ellipsis">
      
        Remove the old configuration folder
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recreate-the-configuration-folder">
<span class="md-ellipsis">
      
        Recreate the configuration folder
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#re-initialize-the-step-ca">
<span class="md-ellipsis">
      
        Re-Initialize the Step CA
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#add-an-acme-provisioner">
<span class="md-ellipsis">
      
        Add an ACME provisioner
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-generated-certificates">
<span class="md-ellipsis">
      
        Remove the generated certificates
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#download-our-root-and-intermediate-certs">
<span class="md-ellipsis">
      
        Download our root and intermediate certs
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-generated-keys">
<span class="md-ellipsis">
      
        Remove the generated keys
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#edit-the-step-ca-config">
<span class="md-ellipsis">
      
        Edit the Step CA config
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#make-sure-all-step-ca-files-are-owned-by-step">
<span class="md-ellipsis">
      
        Make sure all step-ca files are owned by step
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reconnect-the-yubikey-and-verify-step-ca-is-running">
<span class="md-ellipsis">
      
        Reconnect the YubiKey and verify step-ca is running
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sign-a-test-certificate">
<span class="md-ellipsis">
      
        Sign a test certificate
      
    </span>
</a>
<nav aria-label="Sign a test certificate" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#initialize-the-step-ca-environment">
<span class="md-ellipsis">
      
        Initialize the Step CA environment
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-a-test-certificate-for-localhost">
<span class="md-ellipsis">
      
        Generate a test certificate for localhost
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-new-certificate-is-signed">
<span class="md-ellipsis">
      
        Verify the new certificate is signed
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-test-certificate">
<span class="md-ellipsis">
      
        Remove the test certificate
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#yubikey-access">
<span class="md-ellipsis">
      
        YubiKey access
      
    </span>
</a>
<nav aria-label="YubiKey access" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-keys-on-the-yubikey">
<span class="md-ellipsis">
      
        Verify keys on the YubiKey
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-ca-configuration">
<span class="md-ellipsis">
      
        Step CA configuration
      
    </span>
</a>
<nav aria-label="Step CA configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-step-user-and-group">
<span class="md-ellipsis">
      
        Verify the step user and group
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-steppath-directory">
<span class="md-ellipsis">
      
        Verify the $STEPPATH directory
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rebuild-step-ca">
<span class="md-ellipsis">
      
        Rebuild Step CA
      
    </span>
</a>
<nav aria-label="Rebuild Step CA" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-yubikey-from-the-server">
<span class="md-ellipsis">
      
        Remove the YubiKey from the server
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-that-the-step-ca-service-is-stopped">
<span class="md-ellipsis">
      
        Verify that the step-ca service is stopped
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#set-the-steppath-envirnoment-variable">
<span class="md-ellipsis">
      
        Set the $STEPPATH envirnoment variable
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-old-configuration-folder">
<span class="md-ellipsis">
      
        Remove the old configuration folder
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recreate-the-configuration-folder">
<span class="md-ellipsis">
      
        Recreate the configuration folder
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#re-initialize-the-step-ca">
<span class="md-ellipsis">
      
        Re-Initialize the Step CA
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#add-an-acme-provisioner">
<span class="md-ellipsis">
      
        Add an ACME provisioner
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-generated-certificates">
<span class="md-ellipsis">
      
        Remove the generated certificates
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#download-our-root-and-intermediate-certs">
<span class="md-ellipsis">
      
        Download our root and intermediate certs
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-generated-keys">
<span class="md-ellipsis">
      
        Remove the generated keys
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#edit-the-step-ca-config">
<span class="md-ellipsis">
      
        Edit the Step CA config
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#make-sure-all-step-ca-files-are-owned-by-step">
<span class="md-ellipsis">
      
        Make sure all step-ca files are owned by step
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reconnect-the-yubikey-and-verify-step-ca-is-running">
<span class="md-ellipsis">
      
        Reconnect the YubiKey and verify step-ca is running
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sign-a-test-certificate">
<span class="md-ellipsis">
      
        Sign a test certificate
      
    </span>
</a>
<nav aria-label="Sign a test certificate" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#initialize-the-step-ca-environment">
<span class="md-ellipsis">
      
        Initialize the Step CA environment
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-a-test-certificate-for-localhost">
<span class="md-ellipsis">
      
        Generate a test certificate for localhost
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-the-new-certificate-is-signed">
<span class="md-ellipsis">
      
        Verify the new certificate is signed
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#remove-the-test-certificate">
<span class="md-ellipsis">
      
        Remove the test certificate
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="step-ca">Step CA<a class="headerlink" href="#step-ca" title="Permanent link">¬∂</a></h1>
<h2 id="yubikey-access">YubiKey access<a class="headerlink" href="#yubikey-access" title="Permanent link">¬∂</a></h2>
<h3 id="verify-keys-on-the-yubikey">Verify keys on the YubiKey<a class="headerlink" href="#verify-keys-on-the-yubikey" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>ykman<span class="w"> </span>piv<span class="w"> </span>info
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>PIV<span class="w"> </span>version:<span class="w"> </span><span class="m">5</span>.4.3
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>PIN<span class="w"> </span>tries<span class="w"> </span>remaining:<span class="w"> </span><span class="m">5</span>/5
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>Management<span class="w"> </span>key<span class="w"> </span>algorithm:<span class="w"> </span>TDES
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>CHUID:<span class="w">  </span>3019d4e739**********************************************************************************************************
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>CCC:<span class="w">    </span>No<span class="w"> </span>data<span class="w"> </span>available.
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>Slot<span class="w"> </span>9a:
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span>Algorithm:<span class="w">  </span>ECCP256
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span>Subject<span class="w"> </span>DN:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>SharpNET<span class="w"> </span>Root<span class="w"> </span>CA,O<span class="o">=</span>SharpNET
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span>Issuer<span class="w"> </span>DN:<span class="w">  </span><span class="nv">CN</span><span class="o">=</span>SharpNET<span class="w"> </span>Root<span class="w"> </span>CA,O<span class="o">=</span>SharpNET
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span>Serial:<span class="w">     </span><span class="m">5799446925</span>****************************
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span>Fingerprint:<span class="w">    </span>37d6d9c639******************************************************
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span>Not<span class="w"> </span>before:<span class="w"> </span><span class="m">2022</span>-12-28<span class="w"> </span><span class="m">22</span>:20:20
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span>Not<span class="w"> </span>after:<span class="w">  </span><span class="m">2032</span>-12-25<span class="w"> </span><span class="m">22</span>:20:20
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>Slot<span class="w"> </span>9c:
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span>Algorithm:<span class="w">  </span>ECCP256
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span>Subject<span class="w"> </span>DN:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>SharpNET<span class="w"> </span>Intermediate<span class="w"> </span>CA,O<span class="o">=</span>SharpNET
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span>Issuer<span class="w"> </span>DN:<span class="w">  </span><span class="nv">CN</span><span class="o">=</span>SharpNET<span class="w"> </span>Root<span class="w"> </span>CA,O<span class="o">=</span>SharpNET
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span>Serial:<span class="w">     </span><span class="m">1775652118</span>****************************
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span>Fingerprint:<span class="w">    </span>770245a330******************************************************
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span>Not<span class="w"> </span>before:<span class="w"> </span><span class="m">2022</span>-12-28<span class="w"> </span><span class="m">22</span>:20:21
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span>Not<span class="w"> </span>after:<span class="w">  </span><span class="m">2032</span>-12-25<span class="w"> </span><span class="m">22</span>:20:21
</code></pre></div>
<h2 id="step-ca-configuration">Step CA configuration<a class="headerlink" href="#step-ca-configuration" title="Permanent link">¬∂</a></h2>
<h3 id="verify-the-step-user-and-group">Verify the <code>step</code> user and group<a class="headerlink" href="#verify-the-step-user-and-group" title="Permanent link">¬∂</a></h3>
<p>The <code>step</code> user and <code>step</code> group should already exist in the system with the UID of <strong>9501</strong> and GID of <strong>9501</strong></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>‚ùØ<span class="w"> </span>id<span class="w"> </span>step
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nv">uid</span><span class="o">=</span><span class="m">9501</span><span class="o">(</span>step<span class="o">)</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">9501</span><span class="o">(</span>step<span class="o">)</span>
</code></pre></div>
<h3 id="verify-the-steppath-directory">Verify the <code>$STEPPATH</code> directory<a class="headerlink" href="#verify-the-steppath-directory" title="Permanent link">¬∂</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>All files and directories should be owned by the user <strong>step</strong> and the group <strong>step</strong></p>
</div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>‚ùØ<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">STEPPATH</span><span class="o">=</span>/etc/step-ca
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>ls<span class="w"> </span>-ld<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>ls<span class="w"> </span>-ltr<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>drwxr-xr-x<span class="w"> </span><span class="m">6</span><span class="w"> </span>step<span class="w"> </span>step<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">16</span>:07<span class="w"> </span>/etc/step-ca
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>total<span class="w"> </span><span class="m">16</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>drwx------<span class="w"> </span><span class="m">2</span><span class="w"> </span>step<span class="w"> </span>step<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">16</span>:06<span class="w"> </span>templates
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>drwx------<span class="w"> </span><span class="m">2</span><span class="w"> </span>step<span class="w"> </span>step<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">16</span>:07<span class="w"> </span>certs
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>drwx------<span class="w"> </span><span class="m">2</span><span class="w"> </span>step<span class="w"> </span>step<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">16</span>:08<span class="w"> </span>config
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>drwx------<span class="w"> </span><span class="m">2</span><span class="w"> </span>step<span class="w"> </span>step<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">16</span>:47<span class="w"> </span>db
</code></pre></div>
<h2 id="rebuild-step-ca">Rebuild Step CA<a class="headerlink" href="#rebuild-step-ca" title="Permanent link">¬∂</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Rebuilding Step CA should be a last resort. Following these steps will delete all previous configuration, database entries, users etc. After the rebuild we will end up with an empty Certificate Authority, with all provision users destroyed.</p>
</div>
<h3 id="remove-the-yubikey-from-the-server">Remove the YubiKey from the server<a class="headerlink" href="#remove-the-yubikey-from-the-server" title="Permanent link">¬∂</a></h3>
<p>To prevent the step-ca service restarting we have to remove the YubiKey with the SSL keys from the server.</p>
<h3 id="verify-that-the-step-ca-service-is-stopped">Verify that the step-ca service is stopped<a class="headerlink" href="#verify-that-the-step-ca-service-is-stopped" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>step-ca
</code></pre></div>
<div class="highlight"><span class="filename">sudo systemctl status step-ca</span><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>‚óã<span class="w"> </span>step-ca.service<span class="w"> </span>-<span class="w"> </span>step-ca
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">     </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/etc/systemd/system/step-ca.service<span class="p">;</span><span class="w"> </span>enabled<span class="p">;</span><span class="w"> </span>vendor<span class="w"> </span>preset:<span class="w"> </span>enabled<span class="o">)</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="hll"><span class="w">     </span>Active:<span class="w"> </span>inactive<span class="w"> </span><span class="o">(</span>dead<span class="o">)</span>
</span></code></pre></div>
<h3 id="set-the-steppath-envirnoment-variable">Set the <code>$STEPPATH</code> envirnoment variable<a class="headerlink" href="#set-the-steppath-envirnoment-variable" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">STEPPATH</span><span class="o">=</span>/etc/step-ca
</code></pre></div>
<h3 id="remove-the-old-configuration-folder">Remove the old configuration folder<a class="headerlink" href="#remove-the-old-configuration-folder" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
</code></pre></div>
<h3 id="recreate-the-configuration-folder">Recreate the configuration folder<a class="headerlink" href="#recreate-the-configuration-folder" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>sudo<span class="w"> </span>chown<span class="w"> </span>step.step<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
</code></pre></div>
<h3 id="re-initialize-the-step-ca">Re-Initialize the Step CA<a class="headerlink" href="#re-initialize-the-step-ca" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>sudo<span class="w"> </span>--preserve-env<span class="w"> </span>step<span class="w"> </span>ca<span class="w"> </span>init<span class="w"> </span>--name<span class="o">=</span><span class="s2">"SharpNET Root CA"</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">     </span>--dns<span class="o">=</span><span class="s2">"stepca.sharpnet.sdac,10.42.0.10"</span><span class="w"> </span>--address<span class="o">=</span><span class="s2">":443"</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">     </span>--provisioner<span class="o">=</span><span class="s2">"daniel@hagyarossy.hu"</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>Use the arrow keys to navigate: ‚Üì ‚Üë ‚Üí ‚Üê 
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>? What deployment type would you like to configure?: 
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="hll">  ‚ñ∏ Standalone - step-ca instance you run yourself
</span><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>    Linked - standalone, plus cloud configuration, reporting &amp; alerting
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>    Hosted - fully-managed step-ca cloud instance run for you by smallstep
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>‚úî Deployment Type: Standalone
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>Choose a password for your CA keys and first provisioner.
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>‚úî [leave empty and we'll generate one]: 
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>Generating root certificate... done!
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>Generating intermediate certificate... done!
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>‚úî Root certificate: /etc/step-ca/certs/root_ca.crt
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a>‚úî Root private key: /etc/step-ca/secrets/root_ca_key
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>‚úî Root fingerprint: 541c4796245acd99b66b11b2ef9bf239c22a07278450a1e985f84a3e5abb995c
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>‚úî Intermediate certificate: /etc/step-ca/certs/intermediate_ca.crt
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>‚úî Intermediate private key: /etc/step-ca/secrets/intermediate_ca_key
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>‚úî Database folder: /etc/step-ca/db
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a>‚úî Default configuration: /etc/step-ca/config/defaults.json
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a>‚úî Certificate Authority configuration: /etc/step-ca/config/ca.json
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a>Your PKI is ready to go. To generate certificates for individual services see 'step help ca'.
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a>FEEDBACK üòç üçª
<a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a>  The step utility is not instrumented for usage statistics. It does not phone
<a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a>  home. But your feedback is extremely valuable. Any information you can provide
<a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a>  regarding how you‚Äôre using `step` helps. Please send us a sentence or two,
<a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a>  good or bad at feedback@smallstep.com or join GitHub Discussions
<a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a>  https://github.com/smallstep/certificates/discussions and our Discord 
<a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a>  https://u.step.sm/discord.
</code></pre></div>
<h3 id="add-an-acme-provisioner">Add an ACME provisioner<a class="headerlink" href="#add-an-acme-provisioner" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>sudo<span class="w"> </span>step<span class="w"> </span>ca<span class="w"> </span>provisioner<span class="w"> </span>add<span class="w"> </span>acme<span class="w"> </span>--type<span class="w"> </span>acme<span class="w"> </span>--ca-config<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>/config/ca.json
</code></pre></div>
<h3 id="remove-the-generated-certificates">Remove the generated certificates<a class="headerlink" href="#remove-the-generated-certificates" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">"rm </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span><span class="s2">/certs/*.crt"</span>
</code></pre></div>
<h3 id="download-our-root-and-intermediate-certs">Download our root and intermediate certs<a class="headerlink" href="#download-our-root-and-intermediate-certs" title="Permanent link">¬∂</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This is step is currently being moved to the Ansible role so this might become obsolete soon.</p>
</div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://webdav.sharpnet.sdac/static/certs/sharpnet-root.crt<span class="w"> </span>-o<span class="w"> </span>-<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>/certs/root_ca.crt<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;/dev/null
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://webdav.sharpnet.sdac/static/certs/sharpnet-intermediate.crt<span class="w"> </span>-o<span class="w"> </span>-<span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>/certs/intermediate_ca.crt<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;/dev/null
</code></pre></div>
<h3 id="remove-the-generated-keys">Remove the generated keys<a class="headerlink" href="#remove-the-generated-keys" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>/secrets
</code></pre></div>
<h3 id="edit-the-step-ca-config">Edit the Step CA config<a class="headerlink" href="#edit-the-step-ca-config" title="Permanent link">¬∂</a></h3>
<p>The top of the <code class="highlight"><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>/config/ca.json</code> should look like this:</p>
<div class="highlight"><span class="filename">${STEPPATH}/config/ca.json</span><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">        </span><span class="nt">"root"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/etc/step-ca/certs/root_ca.crt"</span><span class="p">,</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">        </span><span class="nt">"federatedRoots"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="nt">"crt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/etc/step-ca/certs/intermediate_ca.crt"</span><span class="p">,</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="hll"><span class="w">        </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yubikey:slot-id=9c"</span><span class="p">,</span>
</span><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="hll"><span class="w">        </span><span class="nt">"kms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="hll"><span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yubikey"</span><span class="p">,</span>
</span><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="hll"><span class="w">            </span><span class="nt">"pin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"******"</span>
</span><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="hll"><span class="w">        </span><span class="p">},</span>
</span><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">        </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">":443"</span><span class="p">,</span>
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="err">...</span>
</code></pre></div>
<h3 id="make-sure-all-step-ca-files-are-owned-by-step">Make sure all <code>step-ca</code> files are owned by <code>step</code><a class="headerlink" href="#make-sure-all-step-ca-files-are-owned-by-step" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>step:step<span class="w"> </span><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span>
</code></pre></div>
<h3 id="reconnect-the-yubikey-and-verify-step-ca-is-running">Reconnect the YubiKey and verify step-ca is running<a class="headerlink" href="#reconnect-the-yubikey-and-verify-step-ca-is-running" title="Permanent link">¬∂</a></h3>
<p>At this stage we can reconnect the YubiKey to the Raspberry and step-ca should start automatically. We can verify the step-ca status using <code>systemctl</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>step-ca
</code></pre></div>
<div class="highlight"><span class="filename">sudo systemctl status step-ca</span><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>‚óè step-ca.service - step-ca
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>     Loaded: loaded (/etc/systemd/system/step-ca.service; enabled; vendor preset: enabled)
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="hll">     Active: active (running) since Tue 2023-01-03 18:02:55 CET; 2s ago
</span><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>   Main PID: 21826 (sh)
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>      Tasks: 11 (limit: 4414)
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>     Memory: 14.8M
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>        CPU: 247ms
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>     CGroup: /system.slice/step-ca.service
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>             ‚îú‚îÄ21826 /bin/sh -c "/usr/local/bin/step-ca /etc/step-ca/config/ca.json"
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>             ‚îî‚îÄ21833 /usr/local/bin/step-ca /etc/step-ca/config/ca.json
</code></pre></div>
<h3 id="sign-a-test-certificate">Sign a test certificate<a class="headerlink" href="#sign-a-test-certificate" title="Permanent link">¬∂</a></h3>
<h4 id="initialize-the-step-ca-environment">Initialize the Step CA environment<a class="headerlink" href="#initialize-the-step-ca-environment" title="Permanent link">¬∂</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The following command will create an environment in your user <code class="highlight"><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span></code> directory. However, the <code class="highlight"><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span></code> variable interfere with this. Make sure you unset <code class="highlight"><span class="si">${</span><span class="nv">STEPPATH</span><span class="si">}</span></code> before running the below commands.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nb">unset</span><span class="w"> </span>STEPPATH
</code></pre></div></p>
</div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>step<span class="w"> </span>ca<span class="w"> </span>bootstrap<span class="w"> </span>--ca-url<span class="o">=</span><span class="s2">"https://stepca.sharpnet.sdac"</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>--fingerprint<span class="w"> </span>37d6d9c639******************************************************
</code></pre></div>
<h4 id="generate-a-test-certificate-for-localhost">Generate a test certificate for <strong>localhost</strong><a class="headerlink" href="#generate-a-test-certificate-for-localhost" title="Permanent link">¬∂</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>step<span class="w"> </span>ca<span class="w"> </span>certificate<span class="w"> </span><span class="s2">"localhost"</span><span class="w"> </span>localhost.crt<span class="w"> </span>localhost.key
</code></pre></div>
<div class="highlight"><span class="filename">step ca certificate "localhost" localhost.crt localhost.key</span><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>‚úî Provisioner: daniel@hagyarossy.hu (JWK) [kid: vx-rj1A...xayE]
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>Please enter the password to decrypt the provisioner key: 
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>‚úî CA: https://stepca.sharpnet.sdac
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>‚úî Certificate: localhost.crt
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>‚úî Private Key: localhost.key
</code></pre></div>
<h4 id="verify-the-new-certificate-is-signed">Verify the new certificate is signed<a class="headerlink" href="#verify-the-new-certificate-is-signed" title="Permanent link">¬∂</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>step<span class="w"> </span>certificate<span class="w"> </span>inspect<span class="w"> </span>localhost.crt<span class="w"> </span>--short
</code></pre></div>
<div class="highlight"><span class="filename">step certificate inspect localhost.crt --short</span><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>X.509v3 TLS Certificate (ECDSA P-256) [Serial: 2057...1521]
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>  Subject:     localhost
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="hll">  Issuer:      SharpNET Intermediate CA
</span><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>  Provisioner: daniel@hagyarossy.hu [ID: vx-r...xayE]
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>  Valid from:  2023-01-03T17:13:52Z
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>          to:  2023-01-04T17:14:52Z
</code></pre></div>
<h4 id="remove-the-test-certificate">Remove the test certificate<a class="headerlink" href="#remove-the-test-certificate" title="Permanent link">¬∂</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>rm<span class="w"> </span>localhost.<span class="o">{</span>key,crt<span class="o">}</span>
</code></pre></div>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 18, 2023</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 18, 2023</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4Z"></path></svg>
</span>
<nav>
<a href="mailto:daniel@hagyarossy.hu">D√°niel Hagy√°rossy</a>
</nav>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"></path></svg>
</span>
<span>GitHub</span>
<nav>
<a class="md-author" href="https://github.com/atraides" title="@atraides">
<img alt="atraides" src="https://avatars.githubusercontent.com/u/510412?size=72"/>
</a>
</nav>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f236eb64.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b5a861c9.min.js"></script>
<script src="/static/js/asciinema-player.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>